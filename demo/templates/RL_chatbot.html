<!DOCTYPE html>
<!-- <html lang="en"> -->

<head>
    <meta charset="utf-8">
    <!--  This file has been downloaded from bootdey.com    @bootdey on twitter -->
    <!--  All snippets are MIT license http://bootdey.com/license -->
    <!-- 
      The codes are free, but we require linking to our web site.
      Why to Link?
      A true story: one girl didn't set a link and had no decent date for two years, and another guy set a link and got a top ranking in Google! 
      Where to Put the Link?
      home, about, credits... or in a good page that you want
      THANK YOU MY FRIEND!
    -->
    <title>Reonforcement Learning Bot</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
    <link href="http://netdna.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='stylesheets/RLbot.min.css') }}">
</head>

<body>
    <nav class="navbar navbar-fixed-top navbar-inverse">
      <a class="navbar-brand" href="#" id="product-title">RL Bot</a>
      <div class="container-fluid">
        <ul class="nav navbar-nav navbar-right">
          <li><a href="#helper"><span class="glyphicon glyphicon-question-sign"></span> Help</a></li>
          <li><a href="#about"><span class="glyphicon glyphicon-user"></span> About Us</a></li>
        </ul>
      </div>
    </nav>
    <div class="container" id="chatbox">
        <div class="col-md-12 col-lg-12">
            <div class="panel box">
                <!--Widget body-->
                <div id="demo-chat-body" class="collapse in">
                    <div class="nano has-scrollbar" style="height:83vh">
                        <div class="nano-content pad-all" tabindex="0" style="right: -17px;">
                            <ul class="list-unstyled media-block" id="msg-list">
                            </ul>
                        </div>
                        <div class="nano-pane">
                            <div class="nano-slider" style="height: 141px; transform: translate(0px, 0px);"></div>
                        </div>
                    </div>

                    <!--Widget footer-->
                    <div class="panel-footer box">
                        <div class="row">
                            <div class="col-xs-9">
                                <div class="row">
                                    <div class="col-xs-10">
                                        <input id="msginput" type="text" placeholder="è«‹åœ¨é€™è£¡è¼¸å…¥" class="form-control chat-input">
                                    </div>
                                    <div class="col-xs-2">
                                        <button id="speechBtn" class="btn btn-block speechBtnOff" type="submit">å•Ÿç”¨èªéŸ³</button>
                                    </div>
                                </div>
                            </div>
                            <div class="col-xs-3">
                                <div class="row">
                                    <div class="col-xs-6">
                                        <button id="sendBtn" class="btn btn-primary btn-block" type="submit">Send</button>
                                    </div>
                                    <div class="col-xs-6">
                                        <button id="resetBtn" class="btn btn-danger btn-block" type="submit">Reset</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id='helper' style="height:50px;"></div>
    <div class="container">
        <div class="col-md-12 col-lg-12">
            <div class="panel box">
                <!--Heading-->
                <div class="panel-heading">
                    <div class="panel-control">
                        <button id="help-btn" type="button" class="btn btn-default" onclick="window.location.href='#'">
                            <span class="glyphicon glyphicon-arrow-up" aria-hidden="true"></span>
                        </button>
                    </div>
                    <h1 class="panel-title">Manual</h1>
                </div>

                <!--Widget body-->
                <div id="help-body" class="collapse in">
                    <div class="nano has-scrollbar" style="height:128vh">
                        <div class="nano-content pad-all" tabindex="0" style="right: -17px;">
                            <!-- <h4>1. èˆ‡ã€Œæµ·æ¿¤ã€æˆç‚ºå¥½å‹ã€‚</h4> -->
                            <h4>1. è·Ÿã€Œæµ·æ¿¤ã€æ‰“æ‹›å‘¼ï¼Œä¾‹å¦‚ï¼šã€Œå¦³å¥½ã€ã€ã€ŒHiã€ã€ã€ŒHelloã€ã€ã€Œæµ·æ¿¤ä½ å¥½ã€ã€‚
                                <div class="nano-content pad-all" tabindex="0" style="right: -17px;">
                                    <section style="margin-left:30px;">
                                        <b> example: </b>
    
                                        <h5>>_ ä½¿ç”¨è€…ï¼šã€Œå¦³å¥½ã€</h5>
                                        <h5>>_ æµ·æ¿¤ï¼šã€ŒHi, ä½ å¥½ğŸ˜„ æˆ‘æ˜¯æµ·æ¿¤ï¼Œæ˜¯æ™ºæ…§çš„æ©Ÿå™¨äººï¼â€¦ã€</h5>
                                    </section>
                                </div>
                            </h4>
                            <h4>2. è¼¸å…¥ã€Œé‡ä¾†ã€æˆ–ã€Œé‡ä¾†å•¦ã€é‡ç½®å°è©±ã€‚è‹¥æˆåŠŸé‡ç½®å°è©±ï¼Œæµ·æ¿¤æœƒèªªã€Œæ³•å¸«åˆcarryäº†ä¸€å ´ã€ä»£è¡¨å°è©±çš„çµæŸã€‚
                                <div class="nano-content pad-all" tabindex="0" style="right: -17px;">
                                    <section style="margin-left:30px;">
                                        <b> example: </b>
    
                                        <h5>>_ ä½¿ç”¨è€…ï¼šã€Œé‡ä¾†ã€</h5>
                                        <h5>>_ æµ·æ¿¤ï¼šã€Œæ³•å¸«åˆcarryäº†ä¸€å ´ã€</h5>
                                    </section>
                                </div>
                            </h4>
                            <h4>3. æå‡ºæƒ³æ‰¾çš„æ±è¥¿ï¼Œä¾‹å¦‚ï¼šã€Œæˆ‘è¦æ‰¾ä½œå“ã€ã€ã€Œæˆ‘è¦æ‰¾æ¼”å“¡ã€ã€ã€Œæˆ‘è¦æ‰¾å‘¨æ˜Ÿé¦³æ¼”çš„ä½œå“ã€ã€ã€Œæˆ‘è¦æ‰¾ç¾åœ‹éšŠé•·çš„æ¼”å“¡ã€ã€ã€Œæˆ‘è¦æ‰¾è©•åˆ†é«˜æ–¼8åˆ†çš„ä½œå“ã€ã€ã€Œæˆ‘è¦æ‰¾ç¾åœ‹éšŠé•·çš„è©•åˆ†ã€ï¼Œæµ·æ¿¤æœƒåˆ†æä½ çš„éœ€æ±‚ã€‚
                                <div class="nano-content pad-all" tabindex="0" style="right: -17px;">
                                    <section style="margin-left:30px;">
                                        <b> example: </b>
    
                                        <h5>>_ ä½¿ç”¨è€…ï¼šã€Œæˆ‘æƒ³æ‰¾å‘¨æ˜Ÿé¦³çš„ä½œå“ã€</h5>
                                        <h5>>_ æµ·æ¿¤ï¼šã€Œè«‹å•ä»–çš„å½±ç‰‡å…§å®¹æ˜¯ä»€éº¼ï¼Ÿä½ çŸ¥é“å—ğŸ¤ ã€</h5>
                                    </section>
                                </div>
                            </h4>
                            <h4>4. æµ·æ¿¤æœƒè¦æ±‚æ›´å¤šçš„è³‡è¨Šï¼Œå°æ‡‰åˆ°ä¸åŒçš„slot typeï¼Œå›æ‡‰æ™‚ç›´æ¥æ‰“å…§å®¹å³å¯ï¼Œè‹¥ä¸æ˜¯å¾ˆç¢ºå®šæˆ–ä¸çŸ¥é“ï¼Œè«‹å›æ‡‰ã€Œæˆ‘ä¸çŸ¥é“ã€ã€‚
                                <div class="nano-content pad-all" tabindex="0" style="right: -17px;">
                                    <section style="margin-left:30px;">
                                        <b> example: é€šå¸¸ä»¥ã€Œå…§å®¹ã€ä¾†ä»£è¡¨è¦æ±‚çš„ slot type ç‚º content</b>
    
                                        <h5>>_ æµ·æ¿¤ï¼šã€Œè«‹å•ä»–çš„å½±ç‰‡å…§å®¹æ˜¯ä»€éº¼ï¼Ÿä½ çŸ¥é“å—ğŸ¤ ã€</h5>
                                        <h5>>_ ä½¿ç”¨è€…ï¼šã€Œç¾åœ‹éšŠé•·ã€</h5>
                                    </section>
                                    <section style="margin-left:30px;">
                                        <b> example: é€šå¸¸ä»¥ã€Œåœ°å€ã€ä¾†ä»£è¡¨è¦æ±‚çš„ slot type ç‚º locationï¼Œä¾‹å¦‚ï¼šã€Œæ—¥éŸ“ã€ã€ã€Œæ­ç¾ã€</b>
    
                                        <h5>>_ æµ·æ¿¤ï¼šã€Œè«‹å•ä»–çš„å½±ç‰‡åœ°å€æ˜¯ä»€éº¼ï¼Ÿä½ çŸ¥é“å—ğŸ¤ ã€</h5>
                                        <h5>>_ ä½¿ç”¨è€…ï¼šã€Œåœ°å€æ˜¯ä¸­æ¸¯è‡ºã€</h5>
                                    </section>
                                    <section style="margin-left:30px;">
                                        <b> example: é€šå¸¸ä»¥ã€Œç‹€æ…‹ã€ä¾†ä»£è¡¨è¦æ±‚çš„ slot type ç‚º statusï¼Œå¯èƒ½çš„è©æœ‰ã€Œå®Œçµã€ã€ã€Œé€£è¼‰ã€å…©ç¨®</b>
    
                                        <h5>>_ æµ·æ¿¤ï¼šã€Œè«‹å•ä»–çš„ç‹€æ…‹æ˜¯ä»€éº¼ï¼Ÿä½ çŸ¥é“å—ğŸ¤ ã€</h5>
                                        <h5>>_ ä½¿ç”¨è€…ï¼šã€Œå®Œçµã€</h5>
                                    </section>
                                    <section style="margin-left:30px;">
                                        <b> example: ç•¶ slot type ç‚ºä¸€å€‹æ•¸å­—ï¼Œæœå°‹æ™‚æ˜¯ä»¥é«˜æ–¼ï¼¸ä¾†ç•¶ä½œ query</b>
    
                                        <h5>>_ æµ·æ¿¤ï¼šã€Œè«‹å•ä»–çš„è©•åˆ†æ˜¯ä»€éº¼ï¼Ÿä½ çŸ¥é“å—ğŸ¤ ã€</h5>
                                        <h5>>_ ä½¿ç”¨è€…ï¼šã€Œ5.0ã€ï¼ˆä¹Ÿå°±æ˜¯é«˜æ–¼5.0åˆ†)</h5>
                                    </section>
                                    <section style="margin-left:30px;">
                                        <b> example: æ›´æ–°æ™‚é–“ (update_time) ç‚º yyyy-mm-dd çš„æ ¼å¼ï¼Œè‹¥ä¸ç¢ºå®šï¼Œè«‹ä»¥æœ€å°å€¼ä»£æ›¿ï¼ˆæ³¨æ„ï¼šæ›´æ–°æ™‚é–“ç‚ºè³‡æ–™åº«æ›´æ–°æ™‚é–“ï¼Œä¸¦éä½œå“ä¸Šæ˜ æ™‚é–“ï¼‰</b>
    
                                        <h5>>_ æµ·æ¿¤ï¼šã€Œè«‹å•ä»–çš„è©•åˆ†æ˜¯ä»€éº¼ï¼Ÿä½ çŸ¥é“å—ğŸ¤ ã€</h5>
                                        <h5>>_ ä½¿ç”¨è€…ï¼š2017-02-23 (ç•¶ä½ å¹´æœˆæ—¥éƒ½çŸ¥é“)</h5>
                                        <h5>>_ ä½¿ç”¨è€…ï¼š2017-02-01 (ç•¶å¦³åªçŸ¥é“æœˆä»½å’Œå¹´ä»½æ™‚)</h5>
                                        <h5>>_ ä½¿ç”¨è€…ï¼š2017-01-01 (ç•¶ä½ åªæƒ³è¼¸å…¥å¹´ä»½æ™‚)</h5>
                                    </section>
                                </div>
                            </h4>
                            <h4>5. æµ·æ¿¤æœƒå‘ä½¿ç”¨è€…ç¢ºèªä»–å¾—åˆ°çš„è³‡è¨Šï¼Œè‹¥ç‚ºæ­£ç¢ºè«‹è¼¸å…¥ã€Œå°ã€ã€ã€Œæ²’éŒ¯ã€ã€ã€Œæ˜¯ã€ã€‚
                                <div class="nano-content pad-all" tabindex="0" style="right: -17px;">
                                    <section style="margin-left:30px;">
                                        <b> example: </b>
    
                                        <h5>>_ æµ·æ¿¤ï¼šã€Œä½ æ˜¯å¦ä¸çŸ¥é“ä½ è¦æ‰¾çš„å…§å®¹ï¼Œå¦‚æœçŸ¥é“è«‹ç›´æ¥å‘Šè¨´æˆ‘è³‡è¨Šï¼ã€</h5>
                                        <h5>>_ ä½¿ç”¨è€…ï¼šã€Œå°ã€ï¼ˆä¾‹å­1ï¼‰</h5>
                                        <h5>>_ æµ·æ¿¤ï¼šã€Œè«‹å•æ‚¨å‰›å‰›èªªçš„å½±ç‰‡å…§å®¹æ˜¯çŠ¯ç½ªå—ï¼ŸğŸ˜…è‹¥å…§å®¹ä¸æ­£ç¢ºï¼Œè«‹è¼¸å…¥å†æ¬¡è¼¸å…¥æ­£ç¢ºçš„ã€‚ã€</h5>
                                        <h5>>_ ä½¿ç”¨è€…ï¼šã€Œè™è ä¿ ã€ï¼ˆä¾‹å­2ï¼‰</h5>
        
                                    </section>
                                </div>
                            </h4> 

                            <h4>6. æµ·æ¿¤å›å‚³çµæœæœƒæ˜¯ä¸€å€‹é›»å½±åˆ—è¡¨ï¼Œè£¡é¢åŒ…å«é›»å½±çš„æ‰€æœ‰è³‡è¨Šã€‚ä½¿ç”¨è€…å¯ä»¥å›æ‡‰ã€Œæˆ‘è¦çµ¦ä½ xåˆ†ã€å¹«æµ·æ¿¤æ‰“åˆ†æ•¸ã€‚
                                <div class="nano-content pad-all" tabindex="0" style="right: -17px;">
                                    <section style="margin-left:30px;">
                                        <b> example: </b>
    
                                        <h5>>_ æµ·æ¿¤ï¼šã€Œä»¥ä¸‹æ˜¯æˆ‘æœå°‹åˆ°çš„çµæœã€</h5>
                                        <h5>>_ æµ·æ¿¤ï¼šã€Œ...é›»å½±åˆ—è¡¨...ã€</h5>
                                        <h5>>_ ä½¿ç”¨è€…ï¼šã€Œæˆ‘è¦çµ¦ä½ 5åˆ†ã€</h5>
                                        <h5>>_ æµ·æ¿¤ï¼šã€Œæ³•å¸«åˆcarryäº†ä¸€å ´ã€ï¼ˆå°è©±çµæŸ)</h5>
                                    </section>
                                </div>
                            </h4> 
                            <ul class="list-unstyled media-block">
                            </ul>
                        </div>
                        <div class="nano-pane">
                            <div class="nano-slider" style="height: 141px; transform: translate(0px, 0px);"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="container" id='about'>
        <div class="col-md-12 col-lg-12">
            <div class="panel box">
                <!--Heading-->
                <div class="panel-heading">
                    <div class="panel-control">
                        <button id="about-btn" type="button" class="btn btn-default" onclick="window.location.href='#'">
                            <span class="glyphicon glyphicon-arrow-up" aria-hidden="true"></span>
                        </button>
                    </div>
                    <h1 class="panel-title">About Us</h1>
                </div>

                <!--Widget body-->
                <div id="about-body" class="collapse in">
                    <div class="nano has-scrollbar" style="height:68vh">
                        <div class="nano-content pad-all" tabindex="0" style="right: -17px;">
                            <div class="row">
                                <div class="col-sm-4">
                                    <div class="nano-content pad-all" tabindex="0" style="right: -17px;">
                                        <h4>Â· b02705021 è¬å¿—é‚¦
                                        <h5>>_ bigelephant29</h5>
                                        <img src="{{ url_for('static', filename = 'img/b02705021.jpg') }}" class="img-circle" alt="æ™ºé‚¦" width="150" height="150">
                                        </h4>
                                    </div>
                                </div>
                                <div class="col-sm-4">
                                    <div class="nano-content pad-all" tabindex="0" style="right: -17px;">
                                        <h4>Â· b02902074 è”¡æ˜†ç¿°
                                        <h5>>_ kevinorjohn</h5>
                                        <img src="{{ url_for('static', filename = 'img/b02902074.jpg') }}" class="img-circle" alt="æ˜†ç¿°" width="150" height="150">
                                        </h4>
                                    </div>
                                </div>
                                <div class="col-sm-4">
                                    <div class="nano-content pad-all" tabindex="0" style="right: -17px;">
                                        <h4>Â· r05922018 é»ƒæŸæ™º
                                        <h5>>_ brianhuang1019</h5>
                                        <img src="{{ url_for('static', filename = 'img/r05922018.png') }}" class="img-circle" alt="æŸæ™º" width="150" height="150">
                                        </h4>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-sm-2">
                                    <div class="nano-content pad-all" tabindex="0" style="right: -17px;">
                                    </div>
                                </div>
                                <div class="col-sm-4">
                                    <div class="nano-content pad-all" tabindex="0" style="right: -17px;">
                                        <h4>Â· r05922021 é™³ç¿°æµ©
                                        <h5>>_ m516825</h5>
                                        <img src="{{ url_for('static', filename = 'img/r05922021.jpg') }}" class="img-circle" alt="ç¿°æµ©" width="150" height="150">
                                        </h4>
                                    </div>
                                </div>
                                <div class="col-sm-4">
                                    <div class="nano-content pad-all" tabindex="0" style="right: -17px;">
                                        <h4>Â· r05922027 æ±Ÿæ±å³»
                                        <h5>>_ gdoggg2032</h5>
                                        <img src="{{ url_for('static', filename = 'img/r05922027.jpg') }}" class="img-circle" alt="Gç‹—" width="150" height="150">
                                        </h4>
                                    </div>
                                </div>
                                <div class="col-sm-2">
                                    <div class="nano-content pad-all" tabindex="0" style="right: -17px;">
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="nano-pane">
                            <div class="nano-slider" style="height: 141px; transform: translate(0px, 0px);"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="http://netdna.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
    <script type="text/javascript">

        var UID = {{ uid }};
        var name_list = ['é‡åº¦æˆ²åŠ‡æˆç™®è€…', 'ç¶²è·¯ç´…äºº', 'å¸¥è‘›è‘›', 'ä¸çœ‹é›»è¦–æœƒæ­»', 'å„„è¼‰é‡‘åŸæ­¦', 'è˜†æ´²æ¹¯å§†å…‹é­¯æ–¯', 'è¿·é€”çš„é›»å½±æ„›å¥½è€…', 'æ¯’èˆŒå½±è©•', 'é‡‘é˜çè©•å¯©', 'å¥§æ–¯å¡å½±å¸', 'æ¸¯éƒ½æ•ä¿Š'];
        var agent_name_list = ['æµ·æ¿¤', 'å°ç£é˜¿æ¿¤ä¸–ç•Œå‰äººè²¡ç¥ç¸½çµ±å½±ç‰‡é”äºº', 'æµ·æ¿¤æ³•å¸«', 'æ¿¤çˆº']

        var idx = parseInt(UID) % name_list.length;
        var USERNAME = name_list[idx];

        idx = parseInt(UID) % agent_name_list.length;
        var AGENTNAME = agent_name_list[idx];
        console.log('uid =', UID, 'username=', USERNAME, 'agentname=', AGENTNAME);

        var speechFlag = 0;
        var supportSpeech = 0;
        var recognition = "";
        initSpeech()

        // speech API
        function initSpeech() {
            if (!('webkitSpeechRecognition' in window)) {
                console.log('This browser doesn\'t  support Google Speech API');
            } 
            else {
                console.log('This browser support Google Speech API');
                supportSpeech = 1;
                
                recognition = new webkitSpeechRecognition()
                recognition.continuous = true;
                recognition.interimResults = true;
                recognition.lang = "cmn-Hant-TW";
                    
                recognition.onstart=function(){
                    $('#speechBtn').html('åœç”¨èªéŸ³');
                    $('#speechBtn').removeClass("speechBtnOff").addClass("speechBtnOn");
                    document.getElementById("msginput").focus();
                    console.log('é–‹å§‹è¾¨è­˜...');
                };
                recognition.onend=function(){
                    $('#speechBtn').html('å•Ÿç”¨èªéŸ³');
                    $('#speechBtn').removeClass("speechBtnOn").addClass("speechBtnOff");
                    document.getElementById("msginput").focus();
                    console.log('åœæ­¢è¾¨è­˜!');
                };
                    
                recognition.onresult=function(event){
                    var i = event.resultIndex;
                    if (event.results[i].isFinal) {
                        var j = event.results[i].length-1;
                        console.log(event.results[i][j].transcript)
                        $('#msginput').val(event.results[i][j].transcript);
                    }
                };
            }
        }
        function switchSpeech() {
            if (speechFlag == 0) {
                if (supportSpeech == 0) {
                    addLeft('æŠ±æ­‰<br />æ‚¨ç”¨çš„ç€è¦½å™¨ä¸æ”¯æ´èªéŸ³è¼¸å…¥QQ<br />ç›®å‰åªæ”¯æ´ ChromeğŸ¤ <br />å•¾å’ªâ¤', 'demo-chat-body', AGENTNAME);
                }
                else {
                    recognition.start();
                    speechFlag = 1;
                }
            }
            else {
                recognition.stop();
                speechFlag = 0;
            }
        }

        // send init msg
        initMessage()

        // support msg submit via pressing Enter
        document.getElementById('msginput').addEventListener('keypress', function(event) {
            if (event.keyCode == 13) {
                event.preventDefault();
                sendMessage();
            }
        });

        // focus on input
        document.getElementById("msginput").focus();

        // get time
        function getTimeStr() {
            var currentdate = new Date();
            curtime = currentdate.getHours() + ":";
            if (parseInt(currentdate.getMinutes()) < 10) {
                curtime += ('0' + currentdate.getMinutes());
            }
            else {
                curtime += currentdate.getMinutes();
            }
            return curtime
        }

        // init msg
        function initMessage() {
            // init msg
            addLeft('My name is æµ·æ¿¤<br />é—œæ–¼å½±ç‰‡çš„äº‹æˆ‘æ²’æœ‰ä¸çŸ¥é“çš„<br />å¦‚æœæœ‰ï¼Œé‚£ä¸€å®šæ˜¯ï¼Œå‡çš„ã€‚<br />æƒ³å¥½å¥½åœ°åˆ©ç”¨æˆ‘çš„æ™ºæ…§å—ï¼Ÿ<br />å»ºè­°ä½ å…ˆå» <b><a href="#helper" style="color:#f90265;">é€™è£¡</a></b> çœ‹çœ‹ä½¿ç”¨èªªæ˜<br />å•¾å’ªâ¤', 'demo-chat-body', AGENTNAME);
        }

        // add to chatbox
        function addLeft(text, blockid, u_name) {
            var timeStr = getTimeStr()
            $(`#${blockid}`).find('ul.list-unstyled').append(`<li class="mar-btm" ><div class="media-left" ><a href="https://pgw.udn.com.tw/gw/photo.php?u=https://uc.udn.com.tw/photo/2016/07/12/99/2365203.jpg&x=0&y=0&sw=0&sh=0&sl=W&fw=800" target="_blank"><img src="{{ url_for('static', filename = 'img/haitao.png') }}" class="img-circle" alt="haitao" width="76" height="76"></a></div><div class="media-body pad-hor"><div class="speech" ><a href="https://zh.wikipedia.org/wiki/%E9%87%8B%E6%B5%B7%E6%BF%A4" target="_blank" class="media-heading">${u_name}</a><p>${text}</p><p class="speech-time"><span class="glyphicon glyphicon-time"></span>${timeStr}</p></div></div></li>`)

            $(`#${blockid}`).find('div.nano-content').animate({ scrollTop: $(`#${blockid}`).find('div.nano-content').prop("scrollHeight") }, 500);
        }
        function addRight(text, blockid, u_name) {
            var timeStr = getTimeStr()
            $(`#${blockid}`).find('ul.list-unstyled').append(`<li class="mar-btm" ><div class="media-right"><img src="{{ url_for('static', filename = 'img/tv.jpg') }}" class="img-circle" alt="user" width="76" height="76"></div><div class="media-body pad-hor speech-right" ><div class="speech" ><p class="media-heading">${u_name}</p><p>${text}</p><p class="speech-time"><span class="glyphicon glyphicon-time"></span>${timeStr}</p></div></div></li>`)

            $(`#${blockid}`).find('div.nano-content').animate({ scrollTop: $(`#${blockid}`).find('div.nano-content').prop("scrollHeight") }, 500);
        }
        function addBusy(text, blockid, u_name) {
            var timeStr = getTimeStr()
            $(`#${blockid}`).find('ul.list-unstyled').append(`<li class="mar-btm" ><div class="media-left" ><a href="https://pgw.udn.com.tw/gw/photo.php?u=https://uc.udn.com.tw/photo/2016/07/12/99/2365203.jpg&x=0&y=0&sw=0&sh=0&sl=W&fw=800" target="_blank"><img src="{{ url_for('static', filename = 'img/haitao.png') }}" class="img-circle" alt="haitao" width="76" height="76"></a></div><div class="media-body pad-hor"><div class="speech" ><a href="https://zh.wikipedia.org/wiki/%E9%87%8B%E6%B5%B7%E6%BF%A4" target="_blank" class="media-heading">${u_name}</a><p><i class="fa fa-spinner w3-spin" style="font-size:64px"></i></p><p class="speech-time"><span class="glyphicon glyphicon-time"></span>${timeStr}</p></div></div></li>`)
        }
        function deleteLast(blockid) {
            var q = $(`#${blockid}`).find('ul.list-unstyled').last().val();
            console.log('q', q);
        }

        // GET & POST msg
        function sendMessage() {
            var msg = $('#demo-chat-body').find('input.chat-input').val();
            $('#demo-chat-body').find('input.chat-input').val("");
            if (msg) {
                addRight(msg, 'demo-chat-body', USERNAME);
                addBusy('æµ·æ¿¤æ€è€ƒä¸­...', 'demo-chat-body', AGENTNAME);

                // make json
                var userMsg = {
                    uid: UID,
                    msg: msg
                };
                console.log(userMsg)

                url = '/messages/' + UID
                fetch(url, {
                    method: 'POST',
                    body: JSON.stringify(userMsg)
                })
                .then(function (data) {
                    console.log('Request success: ', data);
                    getMessage()
                    document.getElementById("msginput").focus();
                })
                .catch(function (error) {  
                    console.log('Request failure: ', error);  
                });
            }
        }
        function getMessage() {
            url = '/messages/' + UID
            fetch(url, {
                method: 'GET',
            })
            .then(function (res) {
                console.log('res', res)
                res.text().then(function (text) {
                    $("#msg-list").children("li:last").remove();
                    // $("#msg-list").last().remove();
                    // deleteLast('demo-chat-body')
                    addLeft(text, 'demo-chat-body', AGENTNAME);
                })
            })
        }

        function deleteMessage() {
            url = '/reset-msg/' + UID
            fetch(url, {
                method: 'GET',
            })
            .then(function (data) {
                console.log('Request success: ', data);
                $('#demo-chat-body').find('ul.list-unstyled').empty()
                initMessage()
                document.getElementById("msginput").focus();
            })
            .catch(function (error) {  
                console.log('Request failure: ', error);  
            });
        }

        // add method to items
        $('#demo-chat-body').find('#speechBtn').click(switchSpeech);
        $('#demo-chat-body').find('#sendBtn').click(sendMessage);
        $('#demo-chat-body').find('#resetBtn').click(deleteMessage);

    </script>
</body>

</html>